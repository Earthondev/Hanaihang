# üîó ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö: ‡∏´‡πâ‡∏≤‡∏á ‚Üî ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Üî ‡∏ä‡∏±‡πâ‡∏ô

## üìä **‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô**

### ‚úÖ **‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß (Working)**

#### 1. **‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Üí ‡∏´‡πâ‡∏≤‡∏á (Store ‚Üí Mall)**
- ‚úÖ **`mallId`**: ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏´‡πâ‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô `store.mallId`
- ‚úÖ **`mallSlug`**: ‡πÄ‡∏Å‡πá‡∏ö slug ‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (denormalized)
- ‚úÖ **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: StoreCard ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ
- ‚úÖ **‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ StoreDetail ‡πÑ‡∏î‡πâ

#### 2. **‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Üí ‡∏ä‡∏±‡πâ‡∏ô (Store ‚Üí Floor)**
- ‚úÖ **`floorId`**: ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏ô `store.floorId`
- ‚úÖ **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: ‡πÅ‡∏™‡∏î‡∏á "‡∏ä‡∏±‡πâ‡∏ô G", "‡∏ä‡∏±‡πâ‡∏ô 1" ‡πÑ‡∏î‡πâ
- ‚úÖ **‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ

#### 3. **‡∏´‡πâ‡∏≤‡∏á ‚Üí ‡∏ä‡∏±‡πâ‡∏ô (Mall ‚Üí Floor)**
- ‚úÖ **Subcollection**: `malls/{mallId}/floors`
- ‚úÖ **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£**: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ
- ‚úÖ **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ

#### 4. **‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (Distance Calculation)**
- ‚úÖ **Logic**: ‡πÉ‡∏ä‡πâ `resolveStoreComputed` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
- ‚úÖ **Fallback**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô, ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡πâ‡∏≤‡∏á (v2), ‡πÅ‡∏•‡∏∞ denormalized values
- ‚úÖ **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÉ‡∏ô StoreCard ‡πÅ‡∏•‡∏∞ StoreDetail

#### 5. **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå**
- ‚úÖ **Logic**: ‡πÉ‡∏ä‡πâ `resolveStoreComputed` ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô (`floor.name` > `floor.label`)
- ‚úÖ **‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÉ‡∏ô StoreDetail

### ‚ö†Ô∏è **‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (Partially Working)**

(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

### ‚ùå **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (Not Working)**

(‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß)

## üîß **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô**

### 1. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡πâ‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤**

```typescript
// ‡πÉ‡∏ô StoreCard ‡∏´‡∏£‡∏∑‡∏≠ StoreDetail
const getStoreLocation = async (store: Store) => {
  if (store.mallId) {
    const mall = await getMall(store.mallId);
    return mall?.coords;
  }
  return store.location;
};

// ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
const storeCoords = await getStoreLocation(store);
if (storeCoords && userLocation) {
  const distance = distanceKm(userLocation, storeCoords);
}
```

### 2. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô**

```typescript
// ‡πÉ‡∏ô StoreCard ‡∏´‡∏£‡∏∑‡∏≠ StoreDetail
const getFloorInfo = async (mallId: string, floorId: string) => {
  const floors = await listFloors(mallId);
  return floors.find(f => f.label === floorId);
};

// ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
const floorInfo = await getFloorInfo(store.mallId!, store.floorId);
const floorDisplay = floorInfo ? `‡∏ä‡∏±‡πâ‡∏ô ${floorInfo.label}` : `‡∏ä‡∏±‡πâ‡∏ô ${store.floorId}`;
```

### 3. **‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Store Interface**

```typescript
interface Store {
  // ... existing fields
  mallId: string;           // Required
  mallSlug: string;         // Required
  floorId: string;          // Required
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö cache
  mallCoords?: { lat: number; lng: number; };
  floorLabel?: string;
}
```

## üéØ **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå**

### **StoreCard ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô**

```typescript
const StoreCard = ({ store, userLocation }) => {
  const [mall, setMall] = useState(null);
  const [floor, setFloor] = useState(null);
  const [distance, setDistance] = useState(null);

  useEffect(() => {
    const loadData = async () => {
      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≤‡∏á
      const mallData = await getMall(store.mallId);
      setMall(mallData);

      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô
      const floorData = await getFloorInfo(store.mallId, store.floorId);
      setFloor(floorData);

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
      if (mallData?.coords && userLocation) {
        const dist = distanceKm(userLocation, mallData.coords);
        setDistance(dist);
      }
    };

    loadData();
  }, [store, userLocation]);

  return (
    <div>
      <h3>{store.name}</h3>
      <p>{mall?.displayName}</p>
      <p>‡∏ä‡∏±‡πâ‡∏ô {floor?.label || store.floorId}</p>
      {distance && <p>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á {distance.toFixed(1)} ‡∏Å‡∏°.</p>}
    </div>
  );
};
```

## üìã **‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**

### **Phase 1: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á**
1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `getMallCoords(storeId)`
2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï StoreCard ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡πâ‡∏≤‡∏á
3. ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÉ‡∏ô StoreCard

### **Phase 2: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô**
1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `getFloorInfo(mallId, floorId)`
2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï StoreCard ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô StoreDetail

### **Phase 3: ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û**
1. ‡πÄ‡∏û‡∏¥‡πà‡∏° caching ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô
2. ‡πÉ‡∏ä‡πâ denormalized data ‡πÉ‡∏ô Store
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° loading states

## üéâ **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á**

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:

1. ‚úÖ **‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á**: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 2.3 ‡∏Å‡∏°."
2. ‚úÖ **‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå**: "‡∏ä‡∏±‡πâ‡∏ô G (Ground Floor)"
3. ‚úÖ **‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≤‡∏á**: "CentralWorld"
4. ‚úÖ **‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏π‡∏ô‡∏¥‡∏ï**: "‡∏¢‡∏π‡∏ô‡∏¥‡∏ï 2-22"
5. ‚úÖ **‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ**: ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡πâ‡∏≤‡∏á
6. ‚úÖ **‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ**: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

## üîç **‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**

### **Test Cases**
1. **StoreCard**: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
2. **StoreDetail**: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
3. **Distance Calculation**: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
4. **Floor Filtering**: ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ
5. **Mall Navigation**: ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ

### **Expected Results**
- ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
