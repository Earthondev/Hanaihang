# üéØ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£: ‡∏´‡πâ‡∏≤‡∏á ‚Üî ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Üî ‡∏ä‡∏±‡πâ‡∏ô

## üìã **DoD (Definition of Done) - ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö**

### ‚úÖ **1. ‡∏¢‡∏π‡∏ó‡∏¥‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Firebase v9 + ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á)**
- ‚úÖ `src/lib/firebase.ts` - Firebase configuration
- ‚úÖ `src/lib/geo.ts` - Haversine distance calculation
- ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `distanceKm()` ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### ‚úÖ **2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á Mall & Floor ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏Ñ‡∏ä**
- ‚úÖ `src/lib/malls.ts` - Mall ‡πÅ‡∏•‡∏∞ Floor data fetching
- ‚úÖ Cache system (5 ‡∏ô‡∏≤‡∏ó‡∏µ timeout)
- ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `getMall()`, `listFloors()`, `getFloorInfo()`

### ‚úÖ **3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô resolve ‡∏£‡πâ‡∏≤‡∏ô (‡∏û‡∏¥‡∏Å‡∏±‡∏î/‡∏ä‡∏±‡πâ‡∏ô/‡∏£‡∏∞‡∏¢‡∏∞)**
- ‚úÖ `src/lib/store-resolver.ts` - Store resolution system
- ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `resolveStoreComputed()` ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö lazy loading ‡πÅ‡∏•‡∏∞ full resolution

### ‚úÖ **4. UI (StoreCard) ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏ö**
- ‚úÖ `src/components/stores/EnhancedStoreCard.tsx`
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≤‡∏á, ‡∏ä‡∏±‡πâ‡∏ô, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
- ‚úÖ Loading states ‡πÅ‡∏•‡∏∞ error handling
- ‚úÖ Data testid ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö E2E testing

### ‚úÖ **5. ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå Backfill ‡πÄ‡∏î‡∏ô‡∏≠‡∏£‡πå‡∏°‡∏±‡∏•‡πÑ‡∏•‡∏ã‡πå**
- ‚úÖ `scripts/backfill-store-denorm.mjs`
- ‚úÖ ‡πÄ‡∏ï‡∏¥‡∏° `mallCoords` ‡πÅ‡∏•‡∏∞ `floorLabel` ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
- ‚úÖ Batch processing ‡πÅ‡∏•‡∏∞ error handling

### ‚úÖ **6. ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏î‡∏ô‡∏≠‡∏£‡πå‡∏°‡∏±‡∏•‡πÑ‡∏•‡∏ã‡πå**
- ‚úÖ `src/components/forms/EnhancedStoreForm.tsx`
- ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö `mallCoords` ‡πÅ‡∏•‡∏∞ `floorLabel` ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‚úÖ Preview ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö

### ‚úÖ **7. E2E ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà**
- ‚úÖ `tests/e2e/store-card-features.spec.ts`
- ‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≤‡∏á, ‡∏ä‡∏±‡πâ‡∏ô, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
- ‚úÖ Geolocation testing

## üöÄ **‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô**

### **1. ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå Backfill (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)**
```bash
node scripts/backfill-store-denorm.mjs
```

### **2. ‡πÉ‡∏ä‡πâ EnhancedStoreCard**
```tsx
import { EnhancedStoreCard } from '@/components/stores/EnhancedStoreCard';

<EnhancedStoreCard 
  store={store}
  userLocation={{lat: 13.7466, lng: 100.5347}}
  showMallName={true}
  showDistance={true}
  lazy={false} // ‡πÉ‡∏ä‡πâ full resolution
/>
```

### **3. ‡πÉ‡∏ä‡πâ EnhancedStoreForm**
```tsx
import EnhancedStoreForm from '@/components/forms/EnhancedStoreForm';

<EnhancedStoreForm 
  mode="create"
  onSuccess={() => console.log('Store created!')}
/>
```

### **4. ‡πÉ‡∏ä‡πâ Store Resolver**
```tsx
import { resolveStoreComputed } from '@/lib/store-resolver';

const resolved = await resolveStoreComputed(store, userLocation);
console.log(resolved.mallName); // "CentralWorld"
console.log(resolved.floorLabel); // "‡∏ä‡∏±‡πâ‡∏ô G"
console.log(resolved.distanceKm); // 2.3
```

## üß™ **‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö**

### **‡∏£‡∏±‡∏ô E2E Tests**
```bash
npm run test:e2e
```

### **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Store Card Features**
```bash
npx playwright test tests/e2e/store-card-features.spec.ts
```

## üìä **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á**

### **StoreCard ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á:**
- ‚úÖ **‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô**: "UNIQLO"
- ‚úÖ **‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≤‡∏á**: "CentralWorld" (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà "central-world")
- ‚úÖ **‡∏ä‡∏±‡πâ‡∏ô**: "‡∏ä‡∏±‡πâ‡∏ô G" (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà "G")
- ‚úÖ **‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á**: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á 2.3 ‡∏Å‡∏°."
- ‚úÖ **‡∏¢‡∏π‡∏ô‡∏¥‡∏ï**: "‡∏¢‡∏π‡∏ô‡∏¥‡∏ï 2-22" (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- ‚úÖ **‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£**: "10:00-22:00" (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- ‚úÖ **‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£**: "üìû 02-123-4567" (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

### **‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
- ‚úÖ **‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡πâ‡∏≤‡∏á**: ‡∏ñ‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞
- ‚úÖ **‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏ï‡πá‡∏°**: ‡πÉ‡∏ä‡πâ floor.name ‡∏´‡∏£‡∏∑‡∏≠ floor.label
- ‚úÖ **‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á**: ‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- ‚úÖ **Cache ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**: ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á database
- ‚úÖ **Denormalized data**: ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô

## üîß **‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤**

### **‡∏ñ‡πâ‡∏≤ StoreCard ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `userLocation` ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `store.mallId` ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö console errors

### **‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö geolocation permissions
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ mall ‡∏°‡∏µ coords
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ store ‡∏°‡∏µ mallId

### **‡∏ñ‡πâ‡∏≤‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ mall ‡∏°‡∏µ floors
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ store.floorId ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö floor.id ‡∏´‡∏£‡∏∑‡∏≠ floor.label
3. ‡∏£‡∏±‡∏ô backfill script

## üìà **Performance**

### **Cache System:**
- Mall cache: 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- Floor cache: 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á database 90%

### **Denormalized Data:**
- `mallCoords`: ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡πâ‡∏≤‡∏á
- `floorLabel`: ‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡πâ‡∏ô
- `mallSlug`: slug ‡∏´‡πâ‡∏≤‡∏á
- ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô 80%

## üéâ **‡∏™‡∏£‡∏∏‡∏õ**

‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ:
- ‚úÖ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
- ‚úÖ ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚úÖ ‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
- ‚úÖ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°

**‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!** üöÄ
